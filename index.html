<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FLAPPY BOX 1.0 - ATROPELAR EDITION</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        canvas {
            border: 2px solid #333;
            background-color: #70c5ce;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            display: block;
            image-rendering: pixelated;
            max-width: 100%;
            max-height: 100%;
        }

        #ui-layer {
            position: absolute;
            pointer-events: none;
            width: 320px;
            height: 480px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        /* --- TELA DE CRÉDITOS --- */
        #tela-creditos {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: black;
            z-index: 100;
            display: none; /* Começa escondido */
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            pointer-events: auto;
        }

        .conteudo-creditos {
            width: 100%;
            text-align: center;
            position: absolute;
            bottom: -650px; /* Começa lá embaixo */
            animation: subirCreditos 15s linear forwards;
            color: white;
            padding: 0 20px;
            box-sizing: border-box;
        }

        @keyframes subirCreditos {
            0% { bottom: -650px; }
            100% { bottom: 100%; } /* Sobe até sumir no topo */
        }

        .credito-secao { margin-bottom: 40px; }
        .credito-titulo { color: #FFD700; font-size: 16px; text-transform: uppercase; margin-bottom: 10px; font-weight: bold;}
        .credito-nome { font-size: 22px; font-weight: bold; margin-bottom: 10px; }
        .credito-foto { 
            width: 100px; height: 100px; 
            border-radius: 50%; border: 3px solid #FFF; 
            object-fit: cover; margin-top: 5px; 
            background-color: #333;
        }
        .credito-lista { font-size: 14px; line-height: 1.6; color: #ccc; }

        #btn-reiniciar-final {
            position: absolute; bottom: 20px;
            padding: 10px 20px; background: #fff; color: #000;
            border: none; border-radius: 5px; font-weight: bold;
            display: none; cursor: pointer; z-index: 101;
        }

        /* TELA DE NÍVEL (BLOQUEANTE - SÓ NIVEL 1) */
        .level-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center; z-index: 20; display: none;
        }

        .level-title { color: #FFD700; font-family: 'Impact', sans-serif; font-size: 40px; margin-bottom: 20px; text-transform: uppercase; text-shadow: 2px 2px 0px #FF4500; letter-spacing: 2px; }
        .level-name { color: #FFF; font-family: 'Arial', sans-serif; font-size: 24px; font-weight: bold; text-transform: uppercase; padding: 0 20px; }

        /* AVISO FLUTUANTE */
        #aviso-flutuante {
            position: absolute; top: 150px; width: 100%;
            text-align: center; opacity: 0; transition: opacity 0.5s;
            z-index: 15; pointer-events: none;
        }
        .aviso-texto-titulo { color: #FFD700; font-family: 'Impact', sans-serif; font-size: 30px; text-shadow: 2px 2px 0 #000; -webkit-text-stroke: 1px black; }
        .aviso-texto-nome { color: #FFF; font-family: 'Arial', sans-serif; font-size: 20px; font-weight: bold; text-shadow: 2px 2px 0 #000; margin-top: 5px; }

        #mensagem-inicio {
            color: white; font-size: 20px; font-weight: bold;
            text-shadow: 2px 2px 0 #000; background: rgba(0,0,0,0.6);
            padding: 15px 25px; border-radius: 20px; text-align: center;
            display: none; pointer-events: auto;
        }

        /* BOTÃO AGREDIR (TOPO DIREITO) */
        #btn-agredir {
            position: absolute; top: 20px; right: 20px;
            width: 90px; height: 90px;
            background-color: #d93838; border: 4px solid #fff; border-radius: 50%;
            color: white; font-weight: bold; font-size: 13px; text-transform: uppercase;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            display: none; pointer-events: auto; align-items: center; justify-content: center;
            z-index: 50; animation: pulse 1s infinite;
            text-align: center; line-height: 1.2; cursor: pointer;
        }
        #btn-agredir:active { transform: scale(0.95); filter: brightness(0.8); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="tela-creditos">
        <div class="conteudo-creditos">
            
            <div class="credito-secao">
                <div class="credito-titulo">Criador e Desenvolvedor</div>
                <div class="credito-nome">FELIPE GAIA CONZO</div>
                <img src="felipe.jpg" class="credito-foto" alt="Felipe">
            </div>

            <div class="credito-secao">
                <div class="credito-titulo">Roteiro e adaptação</div> <div class="credito-nome">LUCAS FAJARDO</div>
                <img src="lucas.jpg" class="credito-foto" alt="Lucas">
            </div>

            <div class="credito-secao">
                <div class="credito-titulo">Imagens</div>
                <div class="credito-lista">Polícia Civil do Estado de São Paulo</div> </div>

            <div class="credito-secao">
                <div class="credito-titulo">Uma realização</div> <div class="credito-nome">GLOBO ESTÚDIOS</div> </div>

            <div class="credito-secao">
                <div class="credito-titulo">Patrocinadores</div>
                <div class="credito-lista">
                    AMBEV<br>
                    TONINHO SALGADO<br>
                    AÇAÍ DA BARRA<br> ZERO
                </div>
            </div>

            <div style="height: 100px;"></div>
        </div>
        <button id="btn-reiniciar-final" onclick="location.reload()">JOGAR NOVAMENTE</button>
    </div>


    <div id="ui-layer">
        <div id="tela-nivel" class="level-screen">
            <div id="txt-nivel-titulo" class="level-title">NIVEL 1</div>
            <div id="txt-nivel-nome" class="level-name">DJ HERCULANO</div>
        </div>

        <div id="aviso-flutuante">
            <div id="float-titulo" class="aviso-texto-titulo">NIVEL 2</div>
            <div id="float-nome" class="aviso-texto-nome">VICTOR SALGADO</div>
        </div>

        <div id="mensagem-inicio">
            Toque para<br>JOGAR
        </div>

        <div id="btn-agredir">AGREDIR<br>(A)</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        // --- CONFIGURAÇÃO ---
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        canvas.width = 320;
        canvas.height = 480;

        let frames = 0;
        let canosGeradosCount = 0;

        // UI Elements
        const telaNivel = document.getElementById("tela-nivel");
        const txtTitulo = document.getElementById("txt-nivel-titulo");
        const txtNome = document.getElementById("txt-nivel-nome");
        const avisoFloat = document.getElementById("aviso-flutuante");
        const floatTitulo = document.getElementById("float-titulo");
        const floatNome = document.getElementById("float-nome");
        const msgInicio = document.getElementById("mensagem-inicio");
        const btnAgredir = document.getElementById("btn-agredir");
        
        const telaCreditos = document.getElementById("tela-creditos");
        const btnReiniciarFinal = document.getElementById("btn-reiniciar-final");

        // Níveis
        const dadosNiveis = {
            1: { titulo: "N\u00CDVEL 1", nome: "DJ HERCULANO", cor: "#70c5ce" },
            2: { titulo: "N\u00CDVEL 2", nome: "VICTOR SALGADO", cor: "#f9c74f" },
            3: { titulo: "N\u00CDVEL 3 (CHEF\u00C3O)", nome: "ANDR\u00C9 GAETA", cor: "#2b2d42" }
        };

        const maxEras = 3;
        const PONTOS_POR_ERA = 6; 
        const PONTOS_PARA_ZERAR = 18; 

        let passouNivel2 = false;
        let passouNivel3 = false;

        // --- IMAGENS ---
        const imgsPassaros = { 
            1: new Image(), 2: new Image(), 3: new Image() 
        };
        imgsPassaros[1].src = 'passaro1.jpg';
        imgsPassaros[2].src = 'passaro2.jpg';
        imgsPassaros[3].src = 'passaro3.jpg';

        const imgObs1_1 = new Image(); imgObs1_1.src = 'obs1_1.jpg'; 
        const imgObs1_2 = new Image(); imgObs1_2.src = 'obs1_2.jpg'; 
        const imgObs2_1 = new Image(); imgObs2_1.src = 'obs2_1.jpg';       
        const imgObs2_2 = new Image(); imgObs2_2.src = 'obs2_2.jpg';       
        const imgObs3_1 = new Image(); imgObs3_1.src = 'obs3_1.jpg'; 
        const imgObs3_2 = new Image(); imgObs3_2.src = 'obs3_2.jpg'; 

        const imgGuitarra = new Image(); imgGuitarra.src = 'guitarra.png';
        
        // NOVA IMAGEM ADICIONADA: CARRO
        const imgCarro = new Image(); imgCarro.src = 'carro.jpg';

        const coresCanosNormais = { 1: "#73bf2e", 2: "#e76f51", 3: "#6c757d" };

        // --- PARTICULAS ---
        let particulas = [];
        function criarExplosao(x, y, cor) {
            for(let i = 0; i < 25; i++) {
                particulas.push({
                    x: x + Math.random() * 50, y: y + Math.random() * 100,
                    vx: (Math.random() - 0.5) * 12, vy: (Math.random() - 0.5) * 12,
                    size: Math.random() * 6 + 2, cor: cor, vida: 1.0
                });
            }
        }
        function desenharParticulas() {
            for(let i = 0; i < particulas.length; i++) {
                let p = particulas[i];
                ctx.fillStyle = p.cor; ctx.globalAlpha = p.vida;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                p.x += p.vx; p.y += p.vy; p.vy += 0.6; p.vida -= 0.03;
                if(p.vida <= 0) { particulas.splice(i, 1); i--; }
            }
            ctx.globalAlpha = 1.0;
        }

        // --- ESTADOS ---
        const estado = { atual: 0, inicio: 0, getReady: 1, jogo: 2, transicao: 3, gameOver: 4, zerado: 5 };
        estado.atual = estado.inicio;

        // --- AÇÃO ---
        function tentarAgredir() {
            if (estado.atual !== estado.jogo) return;

            let alvo = canos._canos.find(c => c.ehEspecial && !c.destruido && c.x < canvas.width && c.x + canos.largura > 0);

            if (alvo) {
                alvo.destruido = true;
                let era = getEraAtual();
                let corExplosao = era === 1 ? "#73bf2e" : (era === 2 ? "#d93838" : "#fff");
                
                // Se for atropelar, explosão cinza escuro
                if (alvo.tipoEspecial === 'atropelar') corExplosao = "#333";

                criarExplosao(alvo.x, alvo.y - 50, corExplosao);
                criarExplosao(alvo.x, alvo.y + alvo.gap + 50, corExplosao);

                if (alvo.tipoEspecial === 'ratiar') passaro.temGuitarra = true;
                btnAgredir.style.display = "none";
            }
        }

        // --- FUNÇÃO PARA REINICIAR O JOGO ---
        function resetarJogoTotal() {
            passaro.reset();
            canos.reset();
            placar.reset();
            frames = 0;
            canosGeradosCount = 0;
            passouNivel2 = false;
            passouNivel3 = false;
            msgInicio.innerHTML = "Toque para<br>JOGAR";
            msgInicio.style.display = "block";
            estado.atual = estado.getReady;
        }

        // --- INPUT ---
        function clique(e) {
            if (e.target.id === 'btn-agredir' || e.target.parentNode.id === 'btn-agredir') {
                tentarAgredir(); return;
            }
            switch(estado.atual) {
                case estado.getReady:
                    estado.atual = estado.jogo;
                    msgInicio.style.display = "none";
                    break;
                case estado.jogo:
                    passaro.pula();
                    break;
                case estado.gameOver:
                    resetarJogoTotal();
                    break;
            }
        }

        window.addEventListener("mousedown", clique);
        window.addEventListener("touchstart", (e) => { 
            if(e.target.id !== 'btn-agredir') e.preventDefault(); clique(e); 
        }, { passive: false });
        
        window.addEventListener("keydown", (e) => { 
            if (e.code === "Space" || e.key === " ") {
                e.preventDefault(); 
                clique({target: {id: 'canvas'}});
            }
            if (e.code === "KeyA") tentarAgredir();
        });
        
        btnAgredir.addEventListener("touchstart", (e) => { e.stopPropagation(); tentarAgredir(); });
        btnAgredir.addEventListener("mousedown", (e) => { e.stopPropagation(); tentarAgredir(); });

        // --- UI ---
        function mostrarTelaNivel1() {
            txtTitulo.innerText = dadosNiveis[1].titulo; txtNome.innerText = dadosNiveis[1].nome;
            telaNivel.style.display = "flex"; btnAgredir.style.display = "none";
            let estadoAnterior = estado.atual; estado.atual = estado.transicao;
            setTimeout(() => {
                telaNivel.style.display = "none";
                if (estadoAnterior === estado.inicio || estadoAnterior === estado.gameOver) {
                    estado.atual = estado.getReady; msgInicio.style.display = "block";
                } else { estado.atual = estado.jogo; }
            }, 2500);
        }

        function mostrarAvisoNivel(nivel) {
            floatTitulo.innerText = dadosNiveis[nivel].titulo; floatNome.innerText = dadosNiveis[nivel].nome;
            avisoFloat.style.opacity = "1"; setTimeout(() => { avisoFloat.style.opacity = "0"; }, 3000);
        }

        function iniciarCreditos() {
            estado.atual = estado.zerado; 
            telaCreditos.style.display = "flex"; 
            setTimeout(() => {
                btnReiniciarFinal.style.display = "block";
            }, 14000);
        }

        mostrarTelaNivel1();

        // --- LÓGICA DO JOGO ---
        function getEraAtual() {
            let era = Math.floor(placar.score / PONTOS_POR_ERA) + 1;
            return era > maxEras ? maxEras : era;
        }

        const passaro = {
            x: 50, y: 150, largura: 34, altura: 34,
            velocidade: 0, gravidade: 0.3, pulo: 5.0, maxVelocidade: 8,
            temGuitarra: false,
            desenha() {
                let era = getEraAtual();
                let img = imgsPassaros[era];
                if (img.complete && img.naturalHeight !== 0) ctx.drawImage(img, this.x, this.y, this.largura, this.altura);
                else { ctx.fillStyle = "#FFD700"; ctx.fillRect(this.x, this.y, this.largura, this.altura); }
                
                if (this.temGuitarra) {
                    if (imgGuitarra.complete && imgGuitarra.naturalHeight !== 0) {
                        ctx.save(); ctx.translate(this.x + 20, this.y + 15); ctx.rotate(-0.5);
                        ctx.drawImage(imgGuitarra, 0, 0, 30, 30); ctx.restore();
                    } else { ctx.fillStyle = "purple"; ctx.fillRect(this.x + 15, this.y + 15, 10, 20); }
                }
            },
            atualiza() {
                let era = getEraAtual();
                if (era > 1) this.temGuitarra = false;
                this.velocidade += this.gravidade;
                if(this.velocidade > this.maxVelocidade) this.velocidade = this.maxVelocidade;
                this.y += this.velocidade;
                if (this.y + this.altura >= canvas.height - chao.altura) {
                    this.y = canvas.height - chao.altura - this.altura; estado.atual = estado.gameOver;
                }
                if (this.y < 0) { this.y = 0; this.velocidade = 0; }
            },
            pula() { this.velocidade = -this.pulo; },
            reset() { this.velocidade = 0; this.y = 150; this.temGuitarra = false; }
        };

        const chao = {
            altura: 80,
            desenha() {
                let era = getEraAtual();
                ctx.fillStyle = era === 1 ? "#ded895" : (era === 2 ? "#e9c46a" : "#444");
                ctx.fillRect(0, canvas.height - this.altura, canvas.width, this.altura);
                ctx.fillStyle = coresCanosNormais[era];
                ctx.fillRect(0, canvas.height - this.altura, canvas.width, 15);
                ctx.strokeStyle = "#333";
                ctx.strokeRect(0, canvas.height - this.altura, canvas.width, this.altura);
            }
        };

        const canos = {
            _canos: [], largura: 52, dx: 3,
            desenha() {
                for (let i = 0; i < this._canos.length; i++) {
                    let c = this._canos[i];
                    if (c.destruido) continue;
                    if (c.ehEspecial) {
                        let img = c.imagemRef; 
                        if (img && img.complete && img.naturalHeight !== 0) {
                            // Desenha a parte de cima (Sempre a pessoa)
                            ctx.drawImage(img, c.x, 0, this.largura, c.y);
                            
                            let by = c.y + c.gap;
                            let h = canvas.height - by - chao.altura;

                            // LOGICA ESPECIAL: Se for Atropelar, desenha o Carro embaixo
                            if (c.tipoEspecial === 'atropelar' && imgCarro.complete) {
                                ctx.drawImage(imgCarro, c.x, by, this.largura, h);
                            } else {
                                // Caso contrário, desenha a mesma imagem (pessoa) embaixo
                                ctx.drawImage(img, c.x, by, this.largura, h);
                            }

                            ctx.strokeStyle = c.tipoEspecial === 'ratiar' ? "#9d00ff" : (c.tipoEspecial === 'atropelar' ? "#FFF" : "red");
                            ctx.lineWidth = 3;
                            ctx.strokeRect(c.x, 0, this.largura, c.y); 
                            ctx.strokeRect(c.x, by, this.largura, canvas.height - by - chao.altura);
                        } else { ctx.fillStyle = "red"; this.desenhaRetangulos(c); }
                    } else {
                        ctx.fillStyle = coresCanosNormais[c.era] || "#73bf2e"; this.desenhaRetangulos(c);
                    }
                }
            },
            desenhaRetangulos(c) {
                ctx.strokeStyle = "#000"; ctx.lineWidth = 2;
                ctx.fillRect(c.x, 0, this.largura, c.y); ctx.strokeRect(c.x, 0, this.largura, c.y);
                let by = c.y + c.gap; let h = canvas.height - by - chao.altura;
                ctx.fillRect(c.x, by, this.largura, h); ctx.strokeRect(c.x, by, this.largura, h);
            },
            atualiza() {
                let especialVivo = this._canos.find(c => c.ehEspecial && !c.destruido && c.x < canvas.width && c.x + this.largura > 0);
                if (especialVivo && estado.atual === estado.jogo) {
                    btnAgredir.style.display = "flex";
                    // ALTERAÇÃO DO BOTÃO CONFORME O TIPO
                    if (especialVivo.tipoEspecial === 'ratiar') {
                        btnAgredir.innerHTML = "RATIAR A<br>GUITARRA";
                        btnAgredir.style.backgroundColor = "#800080"; btnAgredir.style.fontSize = "11px";
                    } else if (especialVivo.tipoEspecial === 'atropelar') {
                        btnAgredir.innerHTML = "ATROPELAR<br>(A)";
                        btnAgredir.style.backgroundColor = "#333"; btnAgredir.style.fontSize = "12px";
                    } else {
                        btnAgredir.innerHTML = "AGREDIR<br>(A)";
                        btnAgredir.style.backgroundColor = "#d93838"; btnAgredir.style.fontSize = "13px";
                    }
                } else { btnAgredir.style.display = "none"; }

                if (frames % 90 === 0) {
                    canosGeradosCount++;
                    let era = getEraAtual();
                    let ehEspecial = false; let tipo = 'normal'; let imagemParaUsar = null;
                    let progressoNaFase = canosGeradosCount % PONTOS_POR_ERA; 
                    if (progressoNaFase === 0) progressoNaFase = PONTOS_POR_ERA;

                    // --- LOGICA DE GERAÇÃO ALTERADA PARA O NÍVEL 3 ---
                    if (progressoNaFase === 3) {
                        ehEspecial = true; 
                        // Se for Era 3 (André Gaeta) e for o cano nº 15 (primeiro especial dele)
                        if (era === 3 && canosGeradosCount === 15) {
                            tipo = 'atropelar'; 
                            imagemParaUsar = imgObs3_1; // André em cima
                        } else {
                            tipo = 'agredir'; 
                            if (era === 1) imagemParaUsar = imgObs1_1;
                            if (era === 2) imagemParaUsar = imgObs2_1;
                            if (era === 3) imagemParaUsar = imgObs3_1;
                        }
                    } else if (progressoNaFase === 6) {
                        ehEspecial = true;
                        if (era === 1) { tipo = 'ratiar'; imagemParaUsar = imgObs1_2; }
                        else if (era === 2) { tipo = 'agredir'; imagemParaUsar = imgObs2_2; }
                        else if (era === 3) { tipo = 'agredir'; imagemParaUsar = imgObs3_2; }
                    }

                    let gap = 110; let min = 50, max = canvas.height - chao.altura - gap - min;
                    let y = Math.floor(Math.random() * (max - min + 1)) + min;

                    this._canos.push({
                        x: canvas.width, y: y, era: era, gap: gap, ehEspecial: ehEspecial, 
                        tipoEspecial: tipo, imagemRef: imagemParaUsar, movel: ehEspecial, 
                        direcaoY: Math.random()>0.5?1:-1, velocidadeY: ehEspecial ? (2.5 + era * 0.5) : 0, destruido: false
                    });
                }

                for (let i = 0; i < this._canos.length; i++) {
                    let c = this._canos[i]; c.x -= this.dx;
                    if (c.movel && !c.destruido) {
                        c.y += c.direcaoY * c.velocidadeY;
                        if (c.y <= 30 || c.y >= canvas.height - chao.altura - c.gap - 30) c.direcaoY *= -1;
                    }
                    if (!c.destruido) {
                        let m = 4;
                        if (passaro.x + passaro.largura - m > c.x && passaro.x + m < c.x + this.largura &&
                            (passaro.y + m < c.y || passaro.y + passaro.altura - m > c.y + c.gap)) {
                            estado.atual = estado.gameOver; btnAgredir.style.display = "none";
                        }
                    }
                    if (c.x + this.largura <= 0) {
                        this._canos.shift(); i--; placar.score++;
                        if (placar.score === 6 && !passouNivel2) { passouNivel2 = true; mostrarAvisoNivel(2); }
                        if (placar.score === 12 && !passouNivel3) { passouNivel3 = true; mostrarAvisoNivel(3); }
                        if (placar.score >= PONTOS_PARA_ZERAR) { iniciarCreditos(); }
                    }
                }
            },
            reset() { this._canos = []; canosGeradosCount = 0; btnAgredir.style.display = "none"; }
        };

        const placar = {
            score: 0, best: localStorage.getItem("flappyFinalBest") || 0,
            desenha() {
                ctx.fillStyle = "#FFF"; ctx.strokeStyle = "#000"; ctx.lineWidth = 3; ctx.textAlign = "center";
                if (estado.atual == estado.jogo || estado.atual == estado.transicao) {
                    ctx.font = "50px Impact"; ctx.fillText(this.score, canvas.width / 2, 80); ctx.strokeText(this.score, canvas.width / 2, 80);
                } else if (estado.atual == estado.gameOver) {
                    if (this.score > this.best) { this.best = this.score; localStorage.setItem("flappyFinalBest", this.best); }
                    ctx.fillStyle = "rgba(0,0,0,0.7)"; ctx.fillRect(0,0, canvas.width, canvas.height);
                    ctx.fillStyle = "#FFF"; ctx.font = "40px Impact";
                    ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2 - 30);
                    ctx.font = "25px Arial"; ctx.fillText("Score: " + this.score, canvas.width/2, canvas.height/2 + 20);
                    ctx.fillText("Best: " + this.best, canvas.width/2, canvas.height/2 + 50);
                    msgInicio.innerHTML = "Toque para<br>REINICIAR"; msgInicio.style.display = "block";
                }
            },
            reset() { this.score = 0; }
        };

        // --- LOOP PRINCIPAL ---
        let then = Date.now();
        const fps = 60;
        const interval = 1000 / fps;

        function loop() {
            requestAnimationFrame(loop);
            let now = Date.now();
            let delta = now - then;
            if (delta > interval) {
                then = now - (delta % interval);
                
                let era = getEraAtual();
                ctx.fillStyle = dadosNiveis[era].cor;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                if (estado.atual == estado.zerado) {
                    canos.desenha(); passaro.desenha(); chao.desenha(); 
                    return;
                }
                if (estado.atual == estado.transicao) {
                    canos.desenha(); passaro.desenha(); chao.desenha(); placar.desenha(); 
                    return;
                }
                if (estado.atual == estado.getReady) {
                    passaro.y = 150 + Math.sin(frames * 0.05) * 5; passaro.desenha(); chao.desenha();
                } 
                else if (estado.atual == estado.jogo) {
                    canos.atualiza(); canos.desenha(); desenharParticulas(); passaro.atualiza(); passaro.desenha(); chao.desenha(); placar.desenha(); frames++;
                } 
                else if (estado.atual == estado.gameOver) {
                    canos.desenha(); desenharParticulas(); passaro.desenha(); chao.desenha(); placar.desenha();
                }
            }
        }

        loop();
    </script>
</body>
</html>
